@startuml
actor Client
participant "Payment Engine" as PE
participant "Integration Orchestration MS" as IO
participant "Qualification Plugin" as Qual
participant "Posting Plugin" as Post
participant "Fraud Plugin" as Fraud
participant "Alert Plugin" as Alert
queue "Kafka Topic" as Kafka
participant CIF
participant Deposit
participant IFMX
participant Titan

Client -> PE: Initiate Payment (Request)
PE -> IO: Send Common Payload

alt Synchronous Flow
    IO -> Qual: Validate, Enrich, Balance Check
    Qual -> CIF: Fetch CIF & Balance
    CIF --> Qual: CIF Details
    Qual --> IO: Enriched Payload
    
    IO -> Post: Deposit Posting
    Post -> Deposit: Post Transaction
    Deposit --> Post: Success/Failure
    
    IO -> Fraud: Fraud Check
    Fraud -> IFMX: Fraud Validation
    IFMX --> Fraud: Result
    
    IO -> Alert: Trigger Alert
    Alert -> Titan: Send Notification
    Titan --> Alert: Ack
    
    IO --> PE: Aggregated Response
    PE --> Client: Payment Result
end

alt Asynchronous Flow
    IO -> Kafka: Publish Event (Async Payload)
    Kafka -> CIF: Notify CIF System
    Kafka -> Deposit: Notify Deposit System
    Kafka -> IFMX: Notify Fraud System
    Kafka -> Titan: Notify Alert System
end
@enduml
